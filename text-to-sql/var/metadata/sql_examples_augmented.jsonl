{"question": "Among first ICU stays, compare average lactate in the first 24 hours by in-hospital mortality status", "sql": "WITH first_icu AS ( SELECT i.SUBJECT_ID, i.HADM_ID, i.STAY_ID, i.INTIME, ROW_NUMBER() OVER (PARTITION BY i.SUBJECT_ID ORDER BY i.INTIME) AS RN FROM ICUSTAYS i WHERE i.INTIME IS NOT NULL ), lactate_24h AS ( SELECT f.HADM_ID, AVG(l.VALUENUM) AS AVG_LACTATE_24H FROM first_icu f JOIN LABEVENTS l ON l.HADM_ID = f.HADM_ID AND l.SUBJECT_ID = f.SUBJECT_ID JOIN D_LABITEMS dl ON dl.ITEMID = l.ITEMID WHERE f.RN = 1 AND l.VALUENUM IS NOT NULL AND dl.LABEL = 'Lactate' AND l.CHARTTIME >= f.INTIME AND l.CHARTTIME < f.INTIME + NUMTODSINTERVAL(24, 'HOUR') GROUP BY f.HADM_ID ) SELECT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN 'Deceased' ELSE 'Survived' END AS MORTALITY_STATUS, AVG(x.AVG_LACTATE_24H) AS AVG_LACTATE_24H FROM lactate_24h x JOIN ADMISSIONS a ON a.HADM_ID = x.HADM_ID GROUP BY CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN 'Deceased' ELSE 'Survived' END ORDER BY MORTALITY_STATUS"}
{"question": "For adult first ICU stays, return first-stay demographics, in-hospital mortality flag, and mean lactate in the first 24 hours", "sql": "WITH base_icu AS ( SELECT p.SUBJECT_ID, a.HADM_ID, i.STAY_ID, i.INTIME, i.OUTTIME, p.GENDER, p.ANCHOR_AGE, ROW_NUMBER() OVER (PARTITION BY i.SUBJECT_ID ORDER BY i.INTIME) AS RN_FIRST_ICU FROM PATIENTS p JOIN ADMISSIONS a ON a.SUBJECT_ID = p.SUBJECT_ID JOIN ICUSTAYS i ON i.HADM_ID = a.HADM_ID AND i.SUBJECT_ID = a.SUBJECT_ID WHERE p.ANCHOR_AGE >= 18 AND i.INTIME IS NOT NULL ), lactate_24h AS ( SELECT b.STAY_ID, b.HADM_ID, b.SUBJECT_ID, AVG(l.VALUENUM) AS MEAN_LACTATE_24H FROM base_icu b JOIN LABEVENTS l ON l.HADM_ID = b.HADM_ID AND l.SUBJECT_ID = b.SUBJECT_ID JOIN D_LABITEMS dl ON dl.ITEMID = l.ITEMID WHERE b.RN_FIRST_ICU = 1 AND l.VALUENUM IS NOT NULL AND dl.LABEL = 'Lactate' AND l.CHARTTIME >= b.INTIME AND l.CHARTTIME < b.INTIME + NUMTODSINTERVAL(24, 'HOUR') GROUP BY b.STAY_ID, b.HADM_ID, b.SUBJECT_ID ) SELECT b.SUBJECT_ID, b.HADM_ID, b.STAY_ID, b.INTIME, b.OUTTIME, b.GENDER, b.ANCHOR_AGE, CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN 1 ELSE 0 END AS IN_HOSP_MORTALITY, la.MEAN_LACTATE_24H FROM base_icu b JOIN ADMISSIONS a ON a.HADM_ID = b.HADM_ID LEFT JOIN lactate_24h la ON la.STAY_ID = b.STAY_ID WHERE b.RN_FIRST_ICU = 1"}
